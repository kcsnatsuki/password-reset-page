<!DOCTYPE html>
<html lang="ja">
<script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDQbKLoqY1N_6pCTweostRxdrv5_lvXKR0",
        authDomain: "karinopurojekuto.firebaseapp.com",
        projectId: "karinopurojekuto"
    };
    firebase.initializeApp(firebaseConfig);
</script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šç”»é¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f9fafb;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .container {
            width: 100%;
            max-width: 28rem;
            background-color: white;
            border: 2px solid #9ca3af;
        }

        .main-content {
            padding: 2rem;
        }

        h1 {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 2rem;
            color: #1f2937;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group.large-margin {
            margin-bottom: 2rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .error-text {
            color: #ef4444;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        input[type="password"],
        input[type="text"] {
            width: 100%;
            padding: 0.75rem 3rem 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            font-size: 1rem;
        }

        input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        input.error {
            border-color: #ef4444;
        }

        .password-container {
            position: relative;
        }

        .eye-btn {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #4b5563;
            cursor: pointer;
            padding: 0.25rem;
            font-size: 1.25rem;
        }

        .eye-btn:hover {
            color: #1f2937;
        }

        .button-group {
            display: flex;
            gap: 1rem;
        }

        button {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: 2px solid #9ca3af;
            background-color: white;
            color: #374151;
            border-radius: 0.25rem;
            font-weight: 500;
            cursor: pointer;
            font-size: 1rem;
        }

        button:hover {
            background-color: #f9fafb;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="main-content">
            <h1>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š</h1>

            <div class="form-group">
                <label>
                    ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                    <span id="passwordError" class="error-text hidden">*ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>
                </label>
                <div class="password-container">
                    <input type="password" id="password" oninput="clearError('password')" />
                    <button type="button" class="eye-btn" onclick="togglePassword('password')">
                        ğŸ‘ï¸
                    </button>
                </div>
            </div>

            <div class="form-group large-margin">
                <label>
                    ç¢ºèªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                    <span id="confirmPasswordError" class="error-text hidden">*ç¢ºèªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>
                </label>
                <div class="password-container">
                    <input type="password" id="confirmPassword" oninput="clearError('confirmPassword')" />
                    <button type="button" class="eye-btn" onclick="togglePassword('confirmPassword')">
                        ğŸ‘ï¸
                    </button>
                </div>
            </div>

            <div class="button-group">
                <button onclick="location.href='../login/email-verification.html'">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="handleChange()">å¤‰æ›´</button>
            </div>
        </div>
    </div>

    <script>
        function handleChange() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!password.trim()) {
                document.getElementById('passwordError').classList.remove('hidden');
                document.getElementById('password').classList.add('error');
                return;
            }

            if (!confirmPassword.trim() || password !== confirmPassword) {
                document.getElementById('confirmPasswordError').classList.remove('hidden');
                document.getElementById('confirmPassword').classList.add('error');
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const oobCode = urlParams.get('oobCode');

            if (!oobCode) {
                alert('èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ã‚‚ã†ä¸€åº¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            firebase.auth().confirmPasswordReset(oobCode, password)
                .then(() => {
                    alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
                    //window.location.href = 'login.html'; // ã¾ãŸã¯ãã®ã¾ã¾çµ‚äº†ã§ã‚‚OK
                })
                .catch((error) => {
                    console.error("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã‚¨ãƒ©ãƒ¼:", error);
                    alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸï¼š' + error.message);
                });
        }

        function handleCancel() {
            document.getElementById('password').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('passwordError').classList.add('hidden');
            document.getElementById('confirmPasswordError').classList.add('hidden');
            document.getElementById('password').classList.remove('error');
            document.getElementById('confirmPassword').classList.remove('error');
            alert('ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
        }

        function togglePassword(fieldId) {
            const input = document.getElementById(fieldId);
            const eyeBtn = input.nextElementSibling;

            if (input.type === 'password') {
                input.type = 'text';
                eyeBtn.textContent = 'ğŸ‘ï¸â€ğŸ—¨ï¸';
            } else {
                input.type = 'password';
                eyeBtn.textContent = 'ğŸ‘ï¸';
            }
        }

        function clearError(field) {
            document.getElementById(field + 'Error').classList.add('hidden');
            document.getElementById(field).classList.remove('error');
        }
    </script>
</body>

</html>